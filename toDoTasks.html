<!DOCTYPE html>
<html>
    <head>
        <title>Todo task</title>
        <meta charset="UTF-8">
    </head>
    <body>

        <div id="app"></div>
        <script>

            let task1 = {text:"Clean room",doneDate:new Date(2025,8,21,16,50),responsible:"John Doe"}
            let task2 = {text:"Build House",doneDate:new Date(2012,7,8,13,50),responsible:"John Doe"}
            let task3 = {text:"Make dinner",doneDate:new Date(2010,2,2,16,10),responsible:"Bob"}
            let task4 = {text:"Produce movie",doneDate:null,responsible:"Amanda"}

            let l = []
            l.push(task1)
            l.push(task2)
            l.push(task3)
            l.push(task4)
            let app = document.getElementById("app")
            let v = ""
            let underLimit = 0
            let limit = 10
            let isNotEveryone = false
            start()
            function start(){
                console.log(v)
                app.innerHTML=`
                <input type="text" id="tak">Task</input>
                <input type="text" id="dat">Date</input>
                <input type="text" id="nam">Name</input>
                <input type="number" id="chosen">Chosen Target</input>
                <ol>
                `
                if(!isNotEveryone){
                    for(let i=underLimit;i<l.length;i++){
                        console.log("i = " + i)
                        dt = l[i].doneDate
                        if(l[i].doneDate==null) dt="not done"
                        if(i == l.length+1){
                            app.innerHTML+=`
                            </ol>`
                        }
                        else if(i<=limit){
                            app.innerHTML+=`
                            <li id="${l[i]}">${l[i].text} ${dt} by ${l[i].responsible} <button onclick="doPart(${i})">Click here to do</button><button onclick="removePart(${i})">Click to remove</button></li>`
                        }
                        else{
                            app.innerHTML+=`<div>Link to go further</div>
                            <button onclick="showpart()">Click here to go to the next part</button>`
                            console.log("added button")
                        }
                    }
                }else{
                    console.log("TESTEST")
                    let newList = []
                    for(i in l){
                        if(l[i].responsible==v){
                            newList.push(l[i])
                        }
                    }
                    for(i in newList){
                        app.innerHTML+=`
                        <li id=${newList[i]}>${newList[i].text} ${newList[i].doneDate} by ${newList[i].responsible} <button onclick="doPart(${i})">Click here to do</button><button onclick="removePart(${i})">Click to remove</button></li>`
                    }
                }
                app.innerHTML+=`
                <button onclick="goBackList()">Click to go back to the other list</div>
                <button onclick="addObject()">Click to add object</button>
                <button onclick="changeText()">Change the text of chosen index</button>
                <button onclick="resetList()">Reset the list back to everyone</button>`
                let optionString=""
                let responsibleList = []
                for(i in l){
                    if(i==0){
                        optionString+=`
                        <select name="dropdown" id="drop" onchange="storeNum(this.value)">
                            <option value="everone">Everyone</option>`
                    }
                    let theNum = parseInt(i)
                    if(!responsibleList.includes(l[i].responsible)){
                        responsibleList.push(l[theNum].responsible)
                        optionString+=`
                        <option value="${l[theNum].responsible}">${l[theNum].responsible}</option>`   
                    }
                    if(i+1==l.length){
                        optionString+=`
                        </select>`
                    }
                }
                console.log(responsibleList)
                app.innerHTML+=optionString 
            }
            function doPart(i){
                let d = new Date
                l[i].doneDate= d
                start()
            }
            function removePart(i){
                l.splice(i,1)
                start()
            }
            
            function addObject(){
                let tak = document.getElementById("tak")
                let dat = document.getElementById("dat")
                let arrayDat = dat.value.split(",")
                let nam = document.getElementById("nam")
                console.log("dat value" + dat.value)
                let inputDat
                if(dat.value==""){
                    inputDat=null
                }
                else{
                    inputDat =  new Date(arrayDat[0],arrayDat[1],arrayDat[2],arrayDat[3],arrayDat[4])
                }
                let tsk = {text:tak.value,doneDate:inputDat,responsible:nam.value}
                console.log(tsk)
                l.push(tsk)
                start()
            }
            function changeText(){
                let chosenNum = document.getElementById("chosen").value
                console.log(chosenNum)
                let tak = document.getElementById("tak")
                let dat = document.getElementById("dat")
                let nam = document.getElementById("nam")
                l[chosenNum].text=tak.value
                l[chosenNum].responsible=nam.value
                start()
            }
            function storeNum(t){
                if(t!="Everyone"){
                    isNotEveryone=true
                }
                v = t
                start()
            }
            function resetList(){
                isNotEveryone=false
                start()
            }
            function showpart(){
                limit+=9
                underLimit+=9
                start()
            }
            function goBackList(){
                if(underLimit!=0){
                    underLimit-=9
                    limit-=9
                }
                start()
            }
            function sortlist(){
                for(i in l){
                    for(j in l){
                        if(l[j].doneDate>l[i].doneDate){
                            temp = l[i]
                            l[i] = l[j]
                            l[j] = temp
                        }
                        if(l[j].doneDate==null){
                            temp = l[0]
                            l[0] = l[j]
                            l[j] = temp  
                        }
                        
                    }
                }
                start()
            }


        </script>
    </body>
</html>